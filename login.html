<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login | Studio Style MCR</title>
  <meta name="description" content="Login to your Studio Style MCR account to view rewards and order history.">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/cart.css?v=4">
  <link rel="stylesheet" href="css/auth.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fjalla+One&family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
</head>
<body>

  <!-- SCROLLING ANNOUNCEMENT BAR -->
  <div class="announcement-ticker">
    <div class="ticker-track">
      <div class="ticker-content">
        <span>FREE DELIVERY ON ORDERS OVER £100</span>
        <span>★</span>
        <span>NEW ARRIVALS EVERY WEEK</span>
        <span>★</span>
        <span>USE CODE <span class="highlight">STUDIO10</span> FOR 10% OFF YOUR FIRST ORDER</span>
        <span>★</span>
      </div>
      <div class="ticker-content">
        <span>FREE DELIVERY ON ORDERS OVER £100</span>
        <span>★</span>
        <span>NEW ARRIVALS EVERY WEEK</span>
        <span>★</span>
        <span>USE CODE <span class="highlight">STUDIO10</span> FOR 10% OFF YOUR FIRST ORDER</span>
        <span>★</span>
      </div>
    </div>
  </div>

  <!-- HEADER -->
  <header class="header">
    <a href="index.html" class="logo">STUDIO STYLE MCR</a>
    <nav class="nav">
      <i class="fas fa-search search-icon" onclick="toggleSearch()"></i>
      <a href="login.html" class="account-link"><i class="fas fa-user"></i></a>
      <a href="account.html#wishlist" class="wishlist-link"><i class="far fa-heart"></i><span class="wishlist-count">0</span></a>
      <div class="cart-link cart-link-header" onclick="toggleMiniCart()">
        <i class="fas fa-shopping-bag"></i>
        <span class="cart-count">0</span>
      </div>
    </nav>
  </header>

  <!-- LOGIN SECTION -->
  <section class="auth-section">
    <div class="auth-container">
      <div class="auth-header">
        <h1>Welcome Back</h1>
        <p>Sign in to access your rewards and order history</p>
      </div>

      <form id="loginForm" class="auth-form">
        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" name="email" required placeholder="Enter your email">
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" required placeholder="Enter your password">
        </div>

        <div class="form-extras">
          <label class="remember-me">
            <input type="checkbox" id="remember">
            <span>Remember me</span>
          </label>
          <a href="#" class="forgot-link" onclick="showForgotPassword(event)">Forgot password?</a>
        </div>

        <div class="form-error" id="formError"></div>

        <button type="submit" class="auth-btn">
          <span class="btn-text">Sign In</span>
          <span class="btn-loading" style="display:none;"><i class="fas fa-spinner fa-spin"></i></span>
        </button>
      </form>

      <div class="auth-footer">
        <p>Don't have an account? <a href="signup.html">Create one</a></p>
      </div>
    </div>
  </section>

  <!-- FORGOT PASSWORD MODAL -->
  <div class="modal-overlay" id="forgotModal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeForgotPassword()">&times;</button>
      <h2>Reset Password</h2>
      <p>Enter your email and we'll send you a reset link</p>
      <form id="forgotForm">
        <div class="form-group">
          <input type="email" id="resetEmail" required placeholder="Enter your email">
        </div>
        <div class="form-error" id="resetError"></div>
        <div class="form-success" id="resetSuccess"></div>
        <button type="submit" class="auth-btn">Send Reset Link</button>
      </form>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-top">
      <div class="footer-brand">
        <div class="footer-logo">STUDIO STYLE MCR</div>
        <p>Women's fashion boutique based in Manchester. Curated style, delivered to your door.</p>
      </div>
      <div class="footer-column">
        <h4>Shop</h4>
        <a href="new-arrivals.html">New In</a>
        <a href="accessories.html">Accessories</a>
        <a href="last-chance.html">Last Chance</a>
        <a href="new-arrivals.html">All Products</a>
      </div>
      <div class="footer-column">
        <h4>Info</h4>
        <a href="about.html">About Us</a>
        <a href="contact.html">Contact</a>
        <a href="style-quiz.html">Style Quiz</a>
        <a href="returns.html">Returns</a>
        <a href="click-collect.html">Click &amp; Collect</a>
        <a href="login.html">My Account</a>
      </div>
      <div class="footer-column">
        <h4>Connect</h4>
        <a href="https://www.instagram.com/the_studio_mcr?igsh=Zmd3NXVvbGNvOXh4" target="_blank"><i class="fab fa-instagram"></i> Instagram</a>
        <a href="https://www.facebook.com/share/1D38Co16cq/?mibextid=wwXIfr" target="_blank"><i class="fab fa-facebook"></i> Facebook</a>
        <a href="https://www.tiktok.com/@thestudiomcr?_r=1&amp;_t=ZN-93QigICnc4E" target="_blank"><i class="fab fa-tiktok"></i> TikTok</a>
        <a href="https://wa.me/447802725901" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
      </div>
    </div>
    <div class="payment-methods">
      <div class="payment-icons">
        <i class="fab fa-cc-visa"></i>
        <i class="fab fa-cc-mastercard"></i>
        <i class="fab fa-apple-pay"></i>
        <i class="fab fa-google-pay"></i>
        <i class="fab fa-klarna"></i>
      </div>
    </div>
    <p class="copyright">&copy; 2026 Studio Style MCR. All rights reserved.</p>
  </footer>

  <!-- Search Overlay -->
  <div class="search-overlay" id="searchOverlay">
    <button class="search-close" onclick="closeSearch()">&times;</button>
    <div class="search-input-wrap">
      <input type="text" id="searchInput" placeholder="Search products..." oninput="performSearch()">
    </div>
    <div class="search-results" id="searchResults"></div>
  </div>

  <!-- Mini Cart Overlay -->
  <div class="mini-cart-overlay" onclick="closeMiniCart()"></div>

  <!-- Mini Cart -->
  <div class="mini-cart" id="miniCart">
    <div class="mini-cart-header">
      <span>Your Basket</span>
      <button class="mini-cart-close" onclick="closeMiniCart()">&times;</button>
    </div>
    <div class="mini-cart-items" id="miniCartItems">
      <div class="mini-cart-empty">Your basket is empty</div>
    </div>
    <div class="mini-cart-footer" id="miniCartFooter" style="display:none;">
      <div class="mini-cart-total">
        <span>Subtotal</span>
        <span id="miniCartTotal">£0.00</span>
      </div>
      <a href="checkout.html" class="mini-cart-btn">Checkout</a>
      <a href="cart.html" class="mini-cart-view">View Basket</a>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js" defer></script>
  <script src="js/products.js" defer></script>
  <script src="js/cart.js" defer></script>
  <script src="js/wishlist.js" defer></script>
  <script src="js/notify.js" defer></script>
  <script src="js/search.js" defer></script>
  <script src="js/auth.js?v=2" defer></script>
  <script>
    // Check if already logged in
    auth.onAuthStateChanged(function(user) {
      if (user) {
        window.location.href = 'index.html';
      }
    });

    // Login Form Handler
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const errorEl = document.getElementById('formError');
      const btnText = document.querySelector('.btn-text');
      const btnLoading = document.querySelector('.btn-loading');

      // Show loading
      btnText.style.display = 'none';
      btnLoading.style.display = 'inline-block';
      errorEl.textContent = '';

      const result = await signIn(email, password);

      if (result.success) {
        window.location.href = 'index.html';
      } else {
        errorEl.textContent = result.error;
        btnText.style.display = 'inline-block';
        btnLoading.style.display = 'none';
      }
    });

    // Google Sign In
    async function signInWithGoogle() {
      const provider = new firebase.auth.GoogleAuthProvider();
      try {
        const result = await auth.signInWithPopup(provider);
        await handleGoogleUser(result.user);
        window.location.href = 'index.html';
      } catch (error) {
        if (error.code === 'auth/popup-blocked' || error.code === 'auth/popup-closed-by-user') {
          // Use redirect instead
          auth.signInWithRedirect(provider);
        } else {
          document.getElementById('formError').textContent = error.message;
        }
      }
    }

    // Handle Google user data
    async function handleGoogleUser(user) {
      const userDoc = await db.collection('users').doc(user.uid).get();
      if (!userDoc.exists) {
        await db.collection('users').doc(user.uid).set({
          firstName: user.displayName?.split(' ')[0] || '',
          lastName: user.displayName?.split(' ').slice(1).join(' ') || '',
          email: user.email,
          phone: '',
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          rewards: {
            orderCount: 0,
            rewardAvailable: false
          },
          purchases: [],
          signInMethod: 'google'
        });
      }
    }

    // Handle redirect result
    auth.getRedirectResult().then(async function(result) {
      if (result.user) {
        await handleGoogleUser(result.user);
        window.location.href = 'index.html';
      }
    }).catch(function(error) {
      if (error.code) {
        document.getElementById('formError').textContent = error.message;
      }
    });

    // Forgot Password Modal
    function showForgotPassword(e) {
      e.preventDefault();
      document.getElementById('forgotModal').classList.add('show');
    }

    function closeForgotPassword() {
      document.getElementById('forgotModal').classList.remove('show');
      document.getElementById('resetError').textContent = '';
      document.getElementById('resetSuccess').textContent = '';
    }

    // Forgot Password Form
    document.getElementById('forgotForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const email = document.getElementById('resetEmail').value;
      const errorEl = document.getElementById('resetError');
      const successEl = document.getElementById('resetSuccess');

      errorEl.textContent = '';
      successEl.textContent = '';

      const result = await resetPassword(email);

      if (result.success) {
        successEl.textContent = 'Password reset email sent! Check your inbox.';
      } else {
        errorEl.textContent = result.error;
      }
    });

    // Close modal on overlay click
    document.getElementById('forgotModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeForgotPassword();
      }
    });
  </script>

</body>
</html>
